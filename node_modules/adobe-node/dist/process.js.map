{"version":3,"file":"process.js","sourceRoot":"","sources":["../src/process.ts"],"names":[],"mappings":";;AAAA,uBAAyB;AACzB,+CAA4E;AAE5E,yBAAgC;AAEhC,IAAM,kBAAkB,GAAG,UAAC,OAAe,EAAE,aAAuB,EAAE,OAA6B;IACjG,IAAI,OAAqB,CAAC;IAC1B,IAAM,eAAe,GAAa,OAAO,CAAC,eAAe,CAAC;IAC1D,IAAM,cAAc,GAAW,OAAO,CAAC,OAAO,IAAI,CAAC,CAAC;IACpD,IAAM,OAAO,GAAW,EAAE,CAAC,QAAQ,EAAE,KAAK,OAAO,CAAC,CAAC,CAAC,OAAO,CAAC,CAAC,CAAC,SAAS,CAAC;IAExE,IAAM,cAAc,GAAG,UAAC,QAAgB,IAAK,OAAA,UAAC,KAAoB,EAAE,MAAc,EAAE,MAAc;QAChG,IAAI,gBAAgB,GAAY,IAAI,CAAC,GAAG,EAAE,GAAG,QAAQ,IAAI,cAAc,IAAI,cAAc,GAAG,CAAC,CAAC;QAC9F,IAAI,gBAAgB,IAAI,eAAe,EAAE;YACvC,eAAe,CAAC,KAAK,CAAC,CAAC;SACxB;aAAM;YACL,aAAa,CAAC,MAAM,CAAC,CAAC;SACvB;IACH,CAAC,EAP4C,CAO5C,CAAC;IAEF,OAAO;QACL,MAAM,EAAC,UAAC,aAAqB;YAC3B,IAAM,gBAAgB,GAAG,cAAc,CAAC,IAAI,CAAC,GAAG,EAAE,CAAC,CAAC;YACpD,IAAG,CAAC,eAAU,CAAC,OAAO,CAAC,EAAE;gBACvB,MAAM,IAAI,KAAK,CAAC,gBAAgB,CAAC,CAAC;aACnC;YACD,OAAO,GAAG,wBAAQ,CAAC,OAAO,EAAE,CAAC,aAAa,CAAC,EAAE,EAAE,OAAO,EAAE,cAAc,EAAE,EAAE,gBAAgB,CAAC,CAAC;QAC9F,CAAC;QACD,IAAI,EAAC;YACH,OAAO,CAAC,IAAI,EAAE,CAAC;QACjB,CAAC;QACD,GAAG,EAAC,UAAC,WAAmB;YACtB,oBAAI,CAAI,OAAO,SAAI,OAAO,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAC,SAAI,WAAW,CAAC,OAAO,CAAC,IAAI,EAAE,KAAK,CAAG,CAAC,CAAC;QACzF,CAAC;KACF,CAAA;AACH,CAAC,CAAA;AAED,kBAAe,kBAAkB,CAAC","sourcesContent":["import * as os from \"os\";\nimport { exec, ChildProcess, execFile, ExecException } from \"child_process\";\nimport { AdobeProcessOptions, AdobeAppProcess } from \"./api\";\nimport { existsSync } from 'fs';\n\nconst newAdobeAppProcess = (appPath: string, closeCallback: Function, options?: AdobeProcessOptions): AdobeAppProcess => {\n  let process: ChildProcess;\n  const timeoutCallback: Function = options.timeoutCallback;\n  const processTimeout: number = options.timeout || 0;\n  const openCmd: string = os.platform() === \"win32\" ? \"start\" : \"open -a\";\n\n  const createCallback = (execTime: number) => (error: ExecException, stdout: string, stderr: string) => {\n    let becauseOfTimeout: boolean = Date.now() - execTime >= processTimeout && processTimeout > 0;\n    if (becauseOfTimeout && timeoutCallback) {\n      timeoutCallback(error);\n    } else {\n      closeCallback(stdout);\n    }\n  };\n\n  return {\n    create:(openAppScript: string): void => {\n      const execFileCallback = createCallback(Date.now());\n      if(!existsSync(appPath)) {\n        throw new Error('Wrong app path');\n      }\n      process = execFile(appPath, [openAppScript], { timeout: processTimeout }, execFileCallback);\n    },\n    kill:(): void => {\n      process.kill();\n    },\n    run:(commandPath: string): void => {\n      exec(`${openCmd} ${appPath.replace(/ /g, \"\\\\ \")} ${commandPath.replace(/ /g, \"\\\\ \")}`);\n    }\n  }\n}\n\nexport default newAdobeAppProcess;"]}