{"version":3,"file":"broadcast.js","sourceRoot":"","sources":["../src/broadcast.ts"],"names":[],"mappings":";;AAAA,6BAAiF;AACjF,+CAAqC;AAErC,IAAM,gBAAgB,GAA+C,IAAI,GAAG,CAAwC;IAClH,CAAC,kBAAY,CAAC,OAAO,EAAE,UAAC,GAAW,IAAK,OAAA,6BAA0B,GAAG,SAAK,EAAlC,CAAkC,CAAC;IAC3E,CAAC,kBAAY,CAAC,SAAS,EAAE,UAAC,GAAW,IAAK,OAAA,kBAAe,GAAG,SAAK,EAAvB,CAAuB,CAAC;IAClE,CAAC,kBAAY,CAAC,WAAW,EAAE,UAAC,GAAW,IAAK,OAAA,kBAAe,GAAG,SAAK,EAAvB,CAAuB,CAAC;CACrE,CAAC,CAAC;AAEH,IAAM,qBAAqB,GAAG,UAAC,IAAY,EAAE,IAAY,EAAE,OAAe;IACxE,OAAA,6BAA2B,IAAI,iBAAY,IAAI,gBAAW,OAAO,MAAG;AAApE,CAAoE,CAAC;AAE1D,QAAA,mBAAmB,GAAG,UAAC,MAAc;IAEhD,OAAO;QACL,KAAK,EAAL,UAAM,OAAe;YACnB,IAAM,OAAO,GAAW,0BAAqB,OAAO,gGAAgF,CAAC;YACrI,IAAM,SAAS,GAA4B,gBAAgB,CAAC,GAAG,CAAC,MAAM,CAAC,GAAG,CAAC,IAAI,CAAC,CAAC;YACjF,IAAM,GAAG,GAAW,qBAAqB,CAAC,MAAM,CAAC,IAAI,EAAE,MAAM,CAAC,IAAI,EAAE,OAAO,CAAC,CAAC;YAC7E,OAAO,SAAS,CAAC,GAAG,CAAC,CAAC;QACxB,CAAC;KACF,CAAA;AACH,CAAC,CAAA;AAEY,QAAA,SAAS,GAAG,UAAC,IAAY,EAAE,IAAY,EAAE,OAAyB;IAC7E,IAAM,GAAG,GAAW,qBAAqB,CAAC,IAAI,EAAE,IAAI,EAAE,IAAI,CAAC,SAAS,CAAC,OAAO,CAAC,CAAC,CAAC;IAC/E,oBAAI,CAAC,GAAG,CAAC,CAAC;AACZ,CAAC,CAAA","sourcesContent":["import { AdobeAppName, BroadcastBuilder, BroadcastMessage, Config } from \"./api\";\nimport { exec } from 'child_process';\n\nconst broadcastMethods: Map<AdobeAppName, (cmd: string) => string> = new Map<AdobeAppName, (cmd: string) => string>([\n  [AdobeAppName.Animate, (cmd: string) => `FLfile.runCommandLine(\"${cmd}\");`],\n  [AdobeAppName.Photoshop, (cmd: string) => `app.system(\"${cmd}\");`],\n  [AdobeAppName.Illustrator, (cmd: string) => `app.system(\"${cmd}\");`],\n]);\n\nconst buildBroadcastCommand = (host: string, port: number, message: string) =>\n  `adobe-broadcast --host='${host}' --port=${port} --msg='${message}'`;\n\nexport const newBroadcastBuilder = (config: Config): BroadcastBuilder => {\n\n  return {\n    build(command: string) {\n      const payload: string = `{\\\\\"command\\\\\":\\\\\"${command}\\\\\",\\\\\"stdout\\\\\":\\\\\"\" + __stdout + \"\\\\\", \\\\\"stderr\\\\\":\\\\\"\" + __stderr + \"\\\\\" }`;\n      const broadcast: (msg: string) => string = broadcastMethods.get(config.app.name);\n      const cmd: string = buildBroadcastCommand(config.host, config.port, payload);\n      return broadcast(cmd);\n    }\n  }\n}\n\nexport const broadcast = (host: string, port: number, message: BroadcastMessage) => {\n  const cmd: string = buildBroadcastCommand(host, port, JSON.stringify(message));\n  exec(cmd);\n}\n"]}