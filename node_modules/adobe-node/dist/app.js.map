{"version":3,"file":"app.js","sourceRoot":"","sources":["../src/app.ts"],"names":[],"mappings":"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","sourcesContent":["\n\nimport { AdobeAppEvent, AdobeAppProcess, CommandFileCreator as AdobeScriptCreator, CommandStack, Config, NewDocumentOptions, Options, AdobeApp, AdobeEventListener } from \"./api\";\nimport newAdobeAppListener from './listener';\nimport newAdobeAppProcess from './process';\nimport newCommandStack from './commands';\nimport newAdobeScriptCreator from './script-file-creator';\nimport { broadcast } from './broadcast';\n\nexport const newAdobeApp = (config: Config, timeoutCallback?: Function): AdobeApp => {\n\n  const scriptCreator: AdobeScriptCreator = newAdobeScriptCreator(config);\n  const commandStack: CommandStack = newCommandStack();\n  const eventListener: AdobeEventListener = newAdobeAppListener(config.host, config.port, eventListenerCallback);\n  const appProcess: AdobeAppProcess = newAdobeAppProcess(config.app.path, appCloseCallback, {\n    timeout: config.appTimeout,\n    timeoutCallback\n  });\n\n  function eventListenerCallback(commandName: string) {\n    commandStack.resolve(commandName);\n  }\n\n  function appCloseCallback() {\n    broadcast(config.host, config.port, { command: AdobeAppEvent.CloseApp });\n  }\n\n  function useBuiltInScript(command: string): boolean {\n    return command === AdobeAppEvent.CloseDocument \n      || command === AdobeAppEvent.SaveDocument\n      || command === AdobeAppEvent.SaveAndCloseDocument\n      || command === AdobeAppEvent.SaveAsDocument\n      || command === AdobeAppEvent.OpenDocument\n      || command === AdobeAppEvent.NewDocument\n      || command === AdobeAppEvent.SelectDocument;\n  }\n\n  const app: AdobeApp = {\n    init() {\n      eventListener.start();\n    },\n    on(event: string, callback: Function): AdobeApp {\n      eventListener.addEventListener(event, callback);\n      return app;\n    },\n\n    runScript: (command: string, options?: Options): Promise<any> =>\n      new Promise(async (resolve, reject) => {\n        const commandPath: string = await scriptCreator.create(command, useBuiltInScript(command), options);\n        commandStack.push({ command, resolve, reject });\n        appProcess.run(commandPath);\n      }),\n\n    saveDocument: (...documents: string[]): Promise<any> =>\n      app.runScript(AdobeAppEvent.SaveDocument, { documents }),\n    \n    selectDocument: (document: string): Promise<any> =>\n      app.runScript(AdobeAppEvent.SelectDocument, { document }),\n\n    saveAsDocument: (document: string, saveAs: string, options?: object): Promise<any> =>\n      app.runScript(AdobeAppEvent.SaveAsDocument, { document, saveAs, options }),\n\n    openDocument: (...documents: string[]): Promise<any> =>\n      app.runScript(AdobeAppEvent.OpenDocument, { documents }),\n\n    closeDocument: (...documents: string[]): Promise<any> =>\n      app.runScript(AdobeAppEvent.CloseDocument, { documents }),\n\n    saveAndCloseDocument: (...documents: string[]): Promise<any> =>\n      app.runScript(AdobeAppEvent.SaveAndCloseDocument, { documents }),\n\n    newDocument: (options?: NewDocumentOptions): Promise<any> =>\n      app.runScript(AdobeAppEvent.NewDocument, options),\n\n    open: (): Promise<any> => new Promise(async (resolve, reject) => {\n      const scriptPath = await scriptCreator.create(AdobeAppEvent.OpenApp)\n      appProcess.create(scriptPath);\n      commandStack.push({\n        command: AdobeAppEvent.OpenApp, resolve, reject\n      });\n    }),\n\n    close: (): Promise<void> => new Promise(async (resolve, reject) => {\n      appProcess.kill();\n      commandStack.push({\n        command: AdobeAppEvent.CloseApp, resolve, reject\n      });\n    }),\n    dispose: (): void => {\n      eventListener.close();\n    }\n  }\n\n  return app;\n}\n"]}